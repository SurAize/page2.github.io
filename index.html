<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>汉字小游戏</title>
  <!-- Tailwind CSS v3 -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#8B4513',
            secondary: '#D2B48C',
            accent: '#CD853F',
            background: '#DEB887',
            cellBackground: '#F5F5F5',
            fixedCell: '#E8E8E8',
            selectedCell: '#FF6B8B',
            correctCell: '#98FB98',
            incorrectCell: '#FFB6C1',
            buttonBackground: '#DAA520',
            buttonHover: '#B8860B',
            text: '#333333'
          },
          fontFamily: {
            sans: ['Arial', 'sans-serif'],
          },
          animation: {
            'shake': 'shake 0.5s ease-in-out',
            'pulse': 'pulse 0.5s ease-in-out',
            'bounce': 'bounce 0.5s ease-in-out',
            'scale': 'scale 0.3s ease-in-out',
          },
          keyframes: {
            shake: {
              '0%, 100%': { transform: 'translate(0, 0)' },
              '10%': { transform: 'translate(-2px, -2px)' },
              '20%': { transform: 'translate(2px, 2px)' },
              '30%': { transform: 'translate(-2px, -2px)' },
              '40%': { transform: 'translate(2px, 2px)' },
              '50%': { transform: 'translate(-2px, -2px)' },
              '60%': { transform: 'translate(2px, 2px)' },
              '70%': { transform: 'translate(-2px, -2px)' },
              '80%': { transform: 'translate(2px, 2px)' },
              '90%': { transform: 'translate(-2px, -2px)' },
            },
            pulse: {
              '0%, 100%': { opacity: 1, backgroundColor: '#98FB98' },
              '50%': { opacity: 0.7, backgroundColor: '#7FFF7F' },
            },
            bounce: {
              '0%, 100%': { transform: 'scale(1)' },
              '50%': { transform: 'scale(1.1)' },
            },
            scale: {
              '0%': { transform: 'scale(1)' },
              '50%': { transform: 'scale(1.1)' },
              '100%': { transform: 'scale(1)' },
            }
          }
        }
      }
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .cell-shadow {
        box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }
      .button-shadow {
        box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }
      .button-press {
        transform: translateY(2px);
        box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.2);
      }
      .cell-selected {
        border: 2px solid #FF6B8B;
        transform: scale(1.05);
        box-shadow: 0 0 0 2px rgba(255, 107, 139, 0.3);
      }
      .cell-error {
        animation: shake 0.5s ease-in-out;
      }
      .cell-correct {
        animation: pulse 0.5s ease-in-out;
      }
      .button-bounce {
        animation: bounce 0.3s ease-in-out;
      }
      .character-used {
        opacity: 0.5;
        transform: scale(0.95);
      }
      .hint-shake {
        animation: shake 0.8s ease-in-out;
        border-color: #FFD700 !important;
      }
    }
    
    /* 自定义样式 */
    body {
      background-color: #DEB887;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23DEB887"/><path d="M0 0L100 100M100 0L0 100" stroke="%23D2B48C" stroke-width="0.5" stroke-opacity="0.2"/></svg>');
    }
    
    .game-container {
      background-color: #D2B48C;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
    
    .function-buttons {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    
    .function-button {
      background-color: #DAA520;
      color: white;
      border: none;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      transition: all 0.2s;
    }
    
    .function-button:hover {
      background-color: #B8860B;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }
    
    .function-button:active {
      transform: translateY(0);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    /* 7x7网格适配 */
    @media (max-width: 640px) {
      .grid-cell {
        width: 10vw !important;
        height: 10vw !important;
        font-size: 5vw !important;
      }
    }
  </style>
</head>
<body class="bg-background min-h-screen flex flex-col items-center justify-center p-4">
  <div class="w-full max-w-2xl mx-auto">
    <header class="text-center mb-6">
      <h1 class="text-3xl font-bold text-primary mb-2">填字小游戏示例</h1>
      <div class="flex justify-between items-center text-sm text-gray-700 bg-secondary rounded-lg p-2">
        <div class="flex items-center">
          <i class="fa fa-star mr-1 text-yellow-600"></i>
          <span id="level">关卡: 1</span>
        </div>
        <div class="flex items-center">
          <i class="fa fa-lightbulb-o mr-1 text-yellow-600"></i>
          <span id="hints">提示: 2</span>
        </div>
      </div>
    </header>

    <div class="game-container bg-secondary rounded-xl shadow-lg p-6 mb-6">
      <!-- 游戏网格将通过JavaScript动态生成 -->
      <div id="crossword-grid" class="flex justify-center mb-6 overflow-x-auto pb-4">
        <!-- 网格内容将在这里生成 -->
      </div>
      
      <!-- 备选汉字区域 -->
      <div id="character-options" class="grid grid-cols-6 sm:grid-cols-8 gap-2 mb-6">
        <!-- 备选汉字将在这里生成 -->
      </div>
      
      <!-- 功能按钮区域 -->
      <div class="function-buttons">
        <button id="reset-button" class="function-button">
          <i class="fa fa-refresh"></i>
        </button>
        <button id="hint-button" class="function-button">
          <i class="fa fa-lightbulb-o"></i>
        </button>
        <button id="check-button" class="function-button">
          <i class="fa fa-check"></i>
        </button>
      </div>
    </div>

    <!-- 成功弹窗 -->
    <div id="success-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-xl p-8 max-w-md w-full mx-4 text-center">
        <div class="text-6xl text-green-500 mb-4">
          <i class="fa fa-check-circle"></i>
        </div>
        <h2 class="text-2xl font-bold mb-2">恭喜你！</h2>
        <p class="mb-6">你成功完成了本关卡！</p>
        <button id="next-level-button" class="bg-primary hover:bg-accent text-white font-bold py-2 px-6 rounded-full shadow transition-all duration-300 transform hover:scale-105">
          下一关
        </button>
      </div>
    </div>
  </div>

  <script>
    // 游戏数据 - 第一关（7x7网格）
    const levelData = [
      {
        // 网格数据: 'fixed'表示固定汉字, 'empty'表示可填空格, 'block'表示空格
        grid: [
          ['block', 'block', 'block', 'fixed', 'block', 'block', 'block'],  // 第0行 - 似
          ['fixed', 'fixed', 'fixed', 'empty', 'block', 'block', 'block'],  // 第1行 - 心 如 止 水
          ['block', 'block', 'block', 'fixed', 'block', 'block', 'block'],  // 第2行 - 流
          ['block', 'block', 'fixed', 'empty', 'empty', 'fixed', 'block'],  // 第3行 - 延 年 益 寿
          ['block', 'block', 'block', 'block', 'block', 'fixed', 'block'],  // 第4行 - 比
          ['block', 'block', 'block', 'fixed', 'empty', 'empty', 'fixed'],  // 第5行 - 东 西 南 北
          ['block', 'block', 'block', 'block', 'block', 'empty', 'block']   // 第6行 - 山
        ],
        // 固定汉字的数据（7x7布局）
        fixedCharacters: {
          '0-3': '似',    // 第0行第3列
          '1-0': '心',    // 第1行第0列
          '1-1': '如',    // 第1行第1列
          '1-2': '止',    // 第1行第2列
          '2-3': '流',    // 第2行第3列
          '3-2': '延',    // 第3行第2列
          '3-5': '寿',    // 第3行第5列
          '4-5': '比',    // 第4行第5列
          '5-3': '东',    // 第5行第3列
          '5-6': '北'     // 第5行第6列
        },
        // 正确答案
        solution: {
          '1-3': '水',    // 第1行第3列 - 心如止水
          '3-3': '年',    // 第3行第3列 - 延年益寿
          '3-4': '益',    // 第3行第4列 - 延年益寿
          '5-4': '西',    // 第5行第4列 - 东南西北
          '5-5': '南',    // 第5行第5列 - 东南西北
          '6-5': '山'     // 第6行第5列 - 寿比南山
        },
        // 备选汉字（增加新成语的字）
        options: ['山', '西', '南', '年', '水', '益'],
        // 成语验证规则
         idioms: [
          {
            name: '心如止水',
            direction: 'horizontal', // 横向
            startRow: 1,
            startCol: 0,
            length: 4,
            characters: ['心', '如', '止', '水']
          },
          {
            name: '似水流年',
            direction: 'vertical', // 竖向
            startRow: 0,
            startCol: 3,
            length: 4,
            characters: ['似', '水', '流', '年']
          },
          {
            name: '延年益寿',
            direction: 'horizontal', // 横向
            startRow: 3,
            startCol: 2,
            length: 4,
            characters: ['延', '年', '益', '寿']
          },
          {
            name: '寿比南山',
            direction: 'vertical', // 竖向
            startRow: 3,
            startCol: 5,
            length: 4,
            characters: ['寿', '比', '南', '山']
          },
          {
            name: '东南西北',
            direction: 'horizontal', // 横向
            startRow: 5,
            startCol: 3,
            length: 4,
            characters: ['东', '西', '南', '北']
          },
        ]
      }
    ];

    // 游戏状态
    let gameState = {
      currentLevel: 0,
      selectedCell: null,
      hintsUsed: 0,
      maxHints: 2, // 增加提示次数以适应更大的网格
      userAnswers: {},
      highlightedCell: null
    };

    // DOM元素
    const crosswordGrid = document.getElementById('crossword-grid');
    const characterOptions = document.getElementById('character-options');
    const resetButton = document.getElementById('reset-button');
    const hintButton = document.getElementById('hint-button');
    const checkButton = document.getElementById('check-button');
    const levelDisplay = document.getElementById('level');
    const hintsDisplay = document.getElementById('hints');
    const successModal = document.getElementById('success-modal');
    const nextLevelButton = document.getElementById('next-level-button');

    // 初始化游戏
    function initGame() {
      loadLevel(gameState.currentLevel);
      updateUI();
      
      // 添加事件监听
      resetButton.addEventListener('click', resetGame);
      hintButton.addEventListener('click', useHint);
      checkButton.addEventListener('click', checkAnswers);
      nextLevelButton.addEventListener('click', goToNextLevel);
    }

    // 加载关卡
    function loadLevel(levelIndex) {
      const level = levelData[levelIndex];
      if (!level) return;
      
      // 重置用户答案
      gameState.userAnswers = {};
      gameState.hintsUsed = 0;
      gameState.highlightedCell = null;
      
      // 创建网格
      createGrid(level);
      
      // 创建备选汉字
      createCharacterOptions(level.options);
      
      // 更新关卡信息
      levelDisplay.textContent = `关卡: ${levelIndex + 1}`;
    }

    // 创建7x7网格
    function createGrid(level) {
      crosswordGrid.innerHTML = '';
      
      // 创建网格容器
      const gridContainer = document.createElement('div');
      gridContainer.className = 'space-y-2'; // 行间距
      
      // 根据网格数据创建单元格
      level.grid.forEach((row, rowIndex) => {
        const rowContainer = document.createElement('div');
        rowContainer.className = 'flex items-center space-x-2'; // 列间距
        
        row.forEach((cellType, colIndex) => {
          const cell = document.createElement('div');
          const cellId = `${rowIndex}-${colIndex}`;
          
          if (cellType === 'block') {
            // 空格 - 保持与其他单元格相同的高度，确保网格对齐
            cell.className = 'w-12 h-12 sm:w-14 sm:h-14 bg-transparent grid-cell';
          } else if (cellType === 'fixed') {
            // 固定汉字
            const char = level.fixedCharacters[cellId];
            cell.className = 'w-12 h-12 sm:w-14 sm:h-14 bg-[#E8E8E8] rounded flex items-center justify-center text-2xl sm:text-3xl font-bold border-2 border-[#CCCCCC] grid-cell';
            cell.textContent = char;
            cell.dataset.id = cellId;
            cell.dataset.type = 'fixed';
          } else if (cellType === 'empty') {
            // 可填空格
            cell.className = 'w-12 h-12 sm:w-14 sm:h-14 bg-[#F5F5F5] rounded flex items-center justify-center text-2xl sm:text-3xl font-bold border-2 border-red-500 cursor-pointer grid-cell';
            cell.dataset.id = cellId;
            cell.dataset.type = 'empty';
            
            // 添加点击事件
            cell.addEventListener('click', () => selectCell(cellId));
          }
          
          rowContainer.appendChild(cell);
        });
        
        gridContainer.appendChild(rowContainer);
      });
      
      crosswordGrid.appendChild(gridContainer);
      
      // 添加提示信息
      const hintInfo = document.createElement('div');
      hintInfo.className = 'text-center text-sm text-gray-600 mt-2';
      hintInfo.textContent = `提示: ${gameState.maxHints - gameState.hintsUsed}`;
      crosswordGrid.appendChild(hintInfo);
      
      // 移除旧的提示显示
      if (hintsDisplay) {
        hintsDisplay.remove();
      }
    }

    // 创建备选汉字
    function createCharacterOptions(options) {
      characterOptions.innerHTML = '<div class="grid grid-cols-6 sm:grid-cols-8 gap-2 mb-6 mx-auto max-w-lg"></div>';
      
      // 创建备选汉字按钮
      options.forEach(char => {
        const button = document.createElement('button');
        button.className = 'w-12 h-12 sm:w-14 sm:h-14 bg-[#FFFFFF] hover:bg-[#F0F0F0] text-[#333333] font-bold rounded flex items-center justify-center text-xl sm:text-2xl border-2 border-[#CCCCCC] shadow-md transition-all duration-200';
        button.textContent = char;
        button.dataset.character = char;
        
        // 添加点击事件
        button.addEventListener('click', () => selectCharacter(char));
        
        characterOptions.appendChild(button);
      });
    }

    // 选择单元格
    function selectCell(cellId) {
      // 移除之前选中单元格的样式
      if (gameState.selectedCell) {
        const prevSelectedCell = document.querySelector(`[data-id="${gameState.selectedCell}"]`);
        if (prevSelectedCell) {
          prevSelectedCell.classList.remove('cell-selected');
        }
      }
      
      // 设置新的选中单元格
      gameState.selectedCell = cellId;
      
      // 添加选中样式
      const selectedCell = document.querySelector(`[data-id="${cellId}"]`);
      if (selectedCell) {
        selectedCell.classList.add('cell-selected');
      }
    }

    // 选择汉字
    function selectCharacter(char) {
      // 如果没有选中单元格，不做任何操作
      if (!gameState.selectedCell) return;
      
      const cellId = gameState.selectedCell;
      const cell = document.querySelector(`[data-id="${cellId}"]`);
      
      // 检查单元格是否是可填空格
      if (cell && cell.dataset.type === 'empty') {
        // 获取当前关卡
        const level = levelData[gameState.currentLevel];
        
        // 检查是否能形成成语
        const canPlaceCharacter = checkIdiomFormation(cellId, char, level);
        
        if (canPlaceCharacter) {
          // 可以放置汉字
          cell.textContent = char;
          cell.classList.add('cell-correct');
          
          // 播放成功音效
          playSound('success');
          
          // 禁用已使用的汉字按钮
          const charButtons = document.querySelectorAll('[data-character]');
          charButtons.forEach(button => {
            if (button.dataset.character === char) {
              button.classList.add('character-used');
              button.disabled = true;
            }
          });
          
          // 记录用户答案
          gameState.userAnswers[cellId] = char;
        } else {
          // 不能放置汉字，显示抖动效果
          cell.classList.add('cell-error');
          
          // 添加红色闪烁效果
          cell.style.backgroundColor = '#FFB6C1';
          setTimeout(() => {
            cell.style.backgroundColor = '';
          }, 100);
          setTimeout(() => {
            cell.style.backgroundColor = '#FFB6C1';
          }, 200);
          setTimeout(() => {
            cell.style.backgroundColor = '';
          }, 300);
          
          // 播放错误音效
          playSound('error');
        }
        
        // 移除选中样式
        cell.classList.remove('cell-selected');
        
        // 清除选中单元格
        gameState.selectedCell = null;
      }
    }
    
    // 检查是否能形成成语
    function checkIdiomFormation(cellId, char, level) {
      const [row, col] = cellId.split('-').map(Number);
      
      // 检查所有成语
      for (const idiom of level.idioms) {
        // 检查当前单元格是否在这个成语的路径上
        let isInIdiomPath = false;
        let positionInIdiom = -1;
        
        if (idiom.direction === 'horizontal') {
          // 横向成语
          if (row === idiom.startRow && col >= idiom.startCol && col < idiom.startCol + idiom.length) {
            isInIdiomPath = true;
            positionInIdiom = col - idiom.startCol;
          }
        } else if (idiom.direction === 'vertical') {
          // 竖向成语
          if (col === idiom.startCol && row >= idiom.startRow && row < idiom.startRow + idiom.length) {
            isInIdiomPath = true;
            positionInIdiom = row - idiom.startRow;
          }
        }
        
        // 如果当前单元格在成语路径上
        if (isInIdiomPath) {
          // 检查这个位置的汉字是否正确
          if (idiom.characters[positionInIdiom] === char) {
            // 检查是否能形成部分或完整的成语
            let correctCount = 0;
            let incorrectCount = 0;
            
            for (let i = 0; i < idiom.length; i++) {
              let currentCellId;
              let currentChar;
              
              if (idiom.direction === 'horizontal') {
                currentCellId = `${idiom.startRow}-${idiom.startCol + i}`;
              } else {
                currentCellId = `${idiom.startRow + i}-${idiom.startCol}`;
              }
              
              // 检查这个位置是否是固定汉字
              if (level.fixedCharacters[currentCellId]) {
                currentChar = level.fixedCharacters[currentCellId];
              } else {
                // 检查这个位置是否已经填写了汉字
                currentChar = gameState.userAnswers[currentCellId];
              }
              
              // 如果当前位置是当前要填写的单元格
              if (currentCellId === cellId) {
                currentChar = char;
              }
              
              // 检查这个位置的汉字是否正确
              if (currentChar && currentChar === idiom.characters[i]) {
                correctCount++;
              } else if (currentChar && currentChar !== idiom.characters[i]) {
                incorrectCount++;
              }
            }
            
            // 如果没有错误的汉字，并且正确的汉字数量至少为3个（对于四字成语）或全部正确（对于其他长度的成语）
            if (incorrectCount === 0) {
              if (idiom.length === 4 && correctCount >= 3) {
                // 四字成语，至少有3个正确
                return true;
              } else if (correctCount === idiom.length) {
                // 其他长度的成语，必须全部正确
                return true;
              }
            }
          }
        }
      }
      
      // 如果不能形成任何成语，返回false
      return false;
    }

    // 使用提示
    function useHint() {
      if (gameState.hintsUsed >= gameState.maxHints) return;
      
      // 获取当前关卡
      const level = levelData[gameState.currentLevel];
      if (!level) return;
      
      let targetCellId = null;
      
      // 检查是否有选中的空白单元格
      if (gameState.selectedCell) {
        const selectedCell = document.querySelector(`[data-id="${gameState.selectedCell}"]`);
        // 验证选中的单元格是否是未填写的空白格
        if (selectedCell && selectedCell.dataset.type === 'empty' && !gameState.userAnswers[gameState.selectedCell]) {
          targetCellId = gameState.selectedCell;
        }
      }
      
      // 如果没有选中有效的空白格，随机选择一个空单元格
      if (!targetCellId) {
        const emptyCells = [];
        for (const cellId in level.solution) {
          if (!gameState.userAnswers[cellId]) {
            emptyCells.push(cellId);
          }
        }
        
        // 如果没有空单元格，不做任何操作
        if (emptyCells.length === 0) return;
        
        targetCellId = emptyCells[Math.floor(Math.random() * emptyCells.length)];
      }
      
      const correctChar = level.solution[targetCellId];
      const cell = document.querySelector(`[data-id="${targetCellId}"]`);
      
      if (cell) {
        // 移除之前高亮的单元格
        if (gameState.highlightedCell) {
          gameState.highlightedCell.classList.remove('highlighted-cell');
        }
        
        // 先让单元格抖动以吸引注意
        cell.classList.add('hint-shake');
        
        // 抖动结束后显示答案
        setTimeout(() => {
          // 移除抖动效果
          cell.classList.remove('hint-shake');
          
          // 显示正确答案
          cell.textContent = correctChar;
          cell.classList.add('cell-correct');
          
          // 记录用户答案
          gameState.userAnswers[targetCellId] = correctChar;
          
          // 禁用已使用的汉字按钮
          const charButtons = document.querySelectorAll('[data-character]');
          charButtons.forEach(button => {
            if (button.dataset.character === correctChar) {
              button.classList.add('character-used');
              button.disabled = true;
            }
          });
          
          // 增加提示使用次数
          gameState.hintsUsed++;
          
          // 更新提示显示
          const hintInfo = document.querySelector('.text-center.text-sm.text-gray-600');
          if (hintInfo) {
            hintInfo.textContent = `提示: ${gameState.maxHints - gameState.hintsUsed}`;
          }
          
          // 清除选中状态
          cell.classList.remove('cell-selected');
          gameState.selectedCell = null;
        }, 800); // 等待抖动动画完成（800ms）
      }
    }

    // 检查答案
    function checkAnswers() {
      // 获取当前关卡
      const level = levelData[gameState.currentLevel];
      if (!level) return;
      
      let allCorrect = true;
      let hasEmptyCells = false;
      
      // 检查所有空格
      for (const cellId in level.solution) {
        const userAnswer = gameState.userAnswers[cellId];
        const correctAnswer = level.solution[cellId];
        const cell = document.querySelector(`[data-id="${cellId}"]`);
        
        if (!userAnswer) {
          // 有空单元格
          hasEmptyCells = true;
          if (cell) {
            cell.classList.add('cell-error');
            
            // 添加红色闪烁效果
            cell.style.backgroundColor = '#FFB6C1';
            setTimeout(() => {
              cell.style.backgroundColor = '';
              cell.classList.remove('cell-error');
            }, 500);
          }
        } else if (userAnswer !== correctAnswer) {
          // 答案不正确
          allCorrect = false;
          if (cell) {
            cell.classList.add('cell-error');
            
            // 添加红色闪烁效果
            cell.style.backgroundColor = '#FFB6C1';
            setTimeout(() => {
              cell.style.backgroundColor = '';
            }, 100);
            setTimeout(() => {
              cell.style.backgroundColor = '#FFB6C1';
            }, 200);
            setTimeout(() => {
              cell.style.backgroundColor = '';
              cell.classList.remove('cell-error');
            }, 500);
          }
        } else {
          // 答案正确
          if (cell) {
            cell.classList.add('cell-correct');
            setTimeout(() => {
              cell.classList.remove('cell-correct');
            }, 500);
          }
        }
      }
      
      // 如果有空单元格，提示用户
      if (hasEmptyCells) {
        showMessage('请先填满所有空格');
        return;
      }
      
      // 如果全部正确，显示成功弹窗
      if (allCorrect) {
        playSound('success');
        showSuccessModal();
      } else {
        playSound('error');
        showMessage('答案不正确，请检查');
      }
    }

    // 重置游戏
    function resetGame() {
      loadLevel(gameState.currentLevel);
    }

    // 显示成功弹窗
    function showSuccessModal() {
      successModal.classList.remove('hidden');
    }

    // 进入下一关
    function goToNextLevel() {
      // 隐藏弹窗
      successModal.classList.add('hidden');
      
      // 进入下一关
      gameState.currentLevel++;
      
      // 检查是否有下一关
      if (gameState.currentLevel < levelData.length) {
        loadLevel(gameState.currentLevel);
      } else {
        // 如果没有下一关，显示通关信息
        showMessage('恭喜你通关了所有关卡！');
        // 重置到第一关
        gameState.currentLevel = 0;
        loadLevel(gameState.currentLevel);
      }
    }

    // 显示消息
    function showMessage(message) {
      // 创建消息元素
      const messageElement = document.createElement('div');
      messageElement.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 bg-black text-white px-4 py-2 rounded-lg shadow-lg z-50';
      messageElement.textContent = message;
      
      // 添加到页面
      document.body.appendChild(messageElement);
      
      // 2秒后移除消息
      setTimeout(() => {
        messageElement.remove();
      }, 2000);
    }
    
    // 播放音效
    function playSound(type) {
      // 创建音频上下文
      const AudioContext = window.AudioContext || window.webkitAudioContext;
      
      // 检查浏览器是否支持Web Audio API
      if (!AudioContext) {
        console.warn('浏览器不支持Web Audio API');
        return;
      }
      
      try {
        const audioContext = new AudioContext();
        
        // 创建振荡器和增益节点
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        // 设置音效参数
        if (type === 'success') {
          // 成功音效 - 上升音调，更愉悦的声音
          oscillator.type = 'sine';
          oscillator.frequency.setValueAtTime(330, audioContext.currentTime);
          oscillator.frequency.exponentialRampToValueAtTime(660, audioContext.currentTime + 0.3);
          gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
          oscillator.start();
          oscillator.stop(audioContext.currentTime + 0.3);
          
          // 添加第二个音调，使音效更丰富
          setTimeout(() => {
            const oscillator2 = audioContext.createOscillator();
            const gainNode2 = audioContext.createGain();
            oscillator2.connect(gainNode2);
            gainNode2.connect(audioContext.destination);
            
            oscillator2.type = 'sine';
            oscillator2.frequency.setValueAtTime(440, audioContext.currentTime);
            oscillator2.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.2);
            gainNode2.gain.setValueAtTime(0.08, audioContext.currentTime);
            gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            oscillator2.start();
            oscillator2.stop(audioContext.currentTime + 0.2);
          }, 150);
        } else if (type === 'error') {
          // 错误音效 - 下降音调，更明显的错误提示
          oscillator.type = 'triangle';
          oscillator.frequency.setValueAtTime(660, audioContext.currentTime);
          oscillator.frequency.exponentialRampToValueAtTime(220, audioContext.currentTime + 0.2);
          gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
          gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
          oscillator.start();
          oscillator.stop(audioContext.currentTime + 0.2);
          
          // 添加第二个音调，模拟抖动效果
          setTimeout(() => {
            const oscillator2 = audioContext.createOscillator();
            const gainNode2 = audioContext.createGain();
            oscillator2.connect(gainNode2);
            gainNode2.connect(audioContext.destination);
            
            oscillator2.type = 'triangle';
            oscillator2.frequency.setValueAtTime(440, audioContext.currentTime);
            oscillator2.frequency.setValueAtTime(330, audioContext.currentTime + 0.05);
            oscillator2.frequency.setValueAtTime(440, audioContext.currentTime + 0.1);
            oscillator2.frequency.setValueAtTime(330, audioContext.currentTime + 0.15);
            gainNode2.gain.setValueAtTime(0.1, audioContext.currentTime);
            gainNode2.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
            oscillator2.start();
            oscillator2.stop(audioContext.currentTime + 0.2);
          }, 100);
        }
      } catch (error) {
        console.error('播放音效失败:', error);
      }
    }

    // 更新UI
    function updateUI() {
      hintsDisplay.textContent = `提示: ${gameState.maxHints - gameState.hintsUsed}`;
    }

    // 初始化游戏
    initGame();
  </script>
</body>
</html>

